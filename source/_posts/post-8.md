
---
title: emojiåœ¨JSä¸­çš„ä½¿ç”¨
date: 2019-04-01 16:58:26
tags:
---

### emojiæ˜¯ä»€ä¹ˆ

è®¡ç®—æœºä¸­çš„å­—ç¬¦éƒ½æ˜¯å€ŸåŠ©äºŒè¿›åˆ¶ç¼–ç æ¥è¡¨ç¤ºï¼Œæœ‰ASCIIï¼Œunicodeç­‰ï¼ŒASCIIç ä¸»è¦ç”¨äºæ˜¾ç¤ºç°ä»£è‹±è¯­å’Œå…¶ä»–è¥¿æ¬§è¯­è¨€ï¼Œå…¶è§„åˆ™æ˜¯ç”±8ä¸ªbitç»„æˆï¼Œç¬¬ä¸€ä¸ªbitä¸º0ï¼Œåˆ©ç”¨å‰©ä½™çš„7ä¸ªbitç»„åˆå‡º128ç§ä¸åŒçš„å­—ç¬¦ï¼Œéšç€è®¡ç®—æœºçš„ä¸æ–­æ¨å¹¿ï¼Œåˆ©ç”¨å•å­—èŠ‚ç¼–ç ç³»ç»Ÿæ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼Œæ— æ³•è¡¨ç¤ºå‡ºæ›´å¤šçš„å­—ç¬¦ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„æ ‡å‡†ï¼Œè€Œè¿™å°±æ˜¯unicodeè¯ç”Ÿçš„åŸå› ã€‚

unicodeä¸ºä¸–ç•Œä¸Šçš„æ‰€æœ‰å­—ç¬¦è¿›è¡Œäº†ç¼–å·ï¼ŒèŒƒå›´ä» 0x000000 åˆ° 0x10FFFFï¼Œå¤§å¤šæ•°å­—ç¬¦åœ¨èŒƒå›´0x0000 åˆ° 0xFFFF ä¹‹é—´ï¼ˆå³å°äº 65536ï¼‰ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½æœ‰ä¸€ä¸ª Unicode ç¼–å·å¹¶ä¸”ä¸€èˆ¬ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå‰ç½® U+ã€‚

emojiä¹Ÿæ˜¯ä¸€ä¸ªunicodeå­—ç¬¦ï¼Œæ¯ä¸€ä¸ªemojiéƒ½åˆ†é…äº†ä¸€ä¸ªå¯¹åº”çš„ç ç‚¹ï¼ˆcode pointï¼‰ï¼Œä¸åŒçš„ç³»ç»Ÿå¯¹åŒä¸€ä¸ªemojiçš„å±•ç¤ºå½¢å¼ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®ç°å½“å‰çš„emojiï¼Œé‚£ä¹ˆæ¸²æŸ“å‡ºæ¥çš„å°±æ˜¯ä¸€ä¸ªç³»ç»Ÿé»˜è®¤è®¾ç½®çš„å†…å®¹
<!-- more -->
### emojiæ€ä¹ˆç”¨

åœ¨jsä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨\uXXXXè¡¨ç¤ºä¸€ä¸ªunicodeå­—ç¬¦ï¼Œå…¶ä¸­XXXXè¡¨ç¤ºçš„æ˜¯Unicodeç ç‚¹ï¼Œåªèƒ½è¡¨ç¤ºå¸¸è§çš„å­—ç¬¦(å³ä½äº0x0000åˆ°0xFFFFèŒƒå›´å†…çš„å­—ç¬¦)ï¼Œè¶…å‡ºèŒƒå›´çš„éœ€è¦ç”¨ä¸¤ä¸ªåŒå­—èŠ‚è¡¨ç¤ºã€‚

```javascript
//åœ¨htmlä¸­çš„å±•ç¤ºåˆ™ä¸º &#x1f61c;
//åœ¨es6ä¸­æ”¯æŒäº†ä»¥ä¸‹ç”¨æ³•è¾“å‡ºemojiå’Œå¯¹emojiè¿›è¡Œè§£ç 

"\u{1f61b}" //ğŸ˜›

String.fromCodePoint("0x1f601") //ğŸ˜›

'ğŸ˜›'.codePointAt(0).toString(16) // 1f61b

```

utf8æ˜¯mysqlä¸­çš„ä¸€ç§å­—ç¬¦é›†ï¼Œåªæ”¯æŒæœ€é•¿ä¸‰ä¸ªå­—èŠ‚çš„ UTF-8å­—ç¬¦ï¼›utf8mb4å¯ä»¥æ”¯æŒå››ä¸ªå­—èŠ‚UTF-8ç¼–ç  ï¼Œä½†æ˜¯è¦ä½¿ç”¨ MySQL çš„è¿™ä¸ªç‰¹æ€§ï¼Œé¦–å…ˆéœ€è¦æŠŠ MySQL å‡çº§åˆ° 5.5.3 ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚

emojiä¸€èˆ¬å å››ä¸ªå­—èŠ‚ï¼Œå¦‚æœä½¿ç”¨MySQLå­˜å‚¨Emoji, éœ€è¦å°†æ•°æ®è¡¨çš„å­—ç¬¦é›†è®¾ç½®ä¸º`utf8mb4`, å³`CHARSET=utf8mb4`ï¼Œè¿™æ ·å°±èƒ½ç›´æ¥å°†ç”¨æˆ·è¾“å…¥çš„emojiä¿¡æ¯å®Œæ•´ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚

**é‚£ä¹ˆï¼Œå¯ä»¥æ ¹æ®ä¸€ä¸ªemojiMappingè¡¨ï¼Œç„¶ååˆ©ç”¨String.fromCodePointè¿›è¡Œè½¬æ¢ç„¶åæ¸²æŸ“åˆ°è§†å›¾ä¸Šï¼Œå†æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©å†è¾“å…¥æ¡†è¿›è¡Œæ‹¼æ¥ï¼Œå³å¯å®ç°emojiè¡¨æƒ…çš„éœ€æ±‚**



### å¼€å‘è¸©å‘è®°å½•

- åœ¨å°ç¨‹åºä¸­ï¼Œinputè¾“å…¥æ¡†å¦‚æœè´´åº•ï¼Œä¼šå‡ºç°è½¯é”®ç›˜ç›´æ¥æ— è§†inputæ¡†çš„çˆ¶å…ƒç´ ç›´æ¥è´´ä½inputæ¡†ï¼Œéœ€è¦ç»™inputæ¡†åŠ ä¸€ä¸ªmargin-bottom

![1548069842886](C:\Users\charliemei\AppData\Roaming\Typora\typora-user-images\1548069842886.png)



- åœ¨h5ä¸­éœ€è¦ç”¨åˆ°**é•¿æŒ‰**äº‹ä»¶å»è¿›è¡Œè¯„è®ºçš„åˆ é™¤ï¼Œè¿™é‡Œç”¨åˆ°äº†**touchstart**ï¼Œ**touchmove**ï¼Œ**touchend**è¿›è¡Œæ¨¡æ‹Ÿï¼Œé¦–å…ˆåœ¨**touchstart**ä¸­è®¾ç½®ä¸€ä¸ª**å®šæ—¶å™¨**ï¼Œåœ¨å®šæ—¶å™¨ä¸­è§¦å‘æ³¨å†Œçš„**å›è°ƒå‡½æ•°**ï¼Œç„¶ååœ¨**touchend**ä¸­å°†è¿™ä¸ª**å®šæ—¶å™¨æ¸…é™¤**ï¼Œå¦‚æœç”¨æˆ·æ˜¯**é•¿æŒ‰**ï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘**å®šæ—¶å™¨**ï¼Œå¦‚æœæ˜¯**ç‚¹å‡»**ä¸€ä¸‹ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨æ‰‹æŒ‡ç¦»å¼€å±å¹•çš„æ—¶å€™è§¦å‘**touchend**å°†**å®šæ—¶å™¨æ¸…é™¤**è€Œä¸ä¼šè¢«è§¦å‘ã€‚åœ¨**å±å¹•æ»šåŠ¨**çš„è¿‡ç¨‹ä¸­ç”±äºä¹Ÿä¼š**é•¿æŒ‰å±å¹•**ï¼Œå› æ­¤éœ€è¦åšä¸€ä¸ªåŒºåˆ†ï¼Œ**æ»šåŠ¨**è¿‡ç¨‹ä¼šè§¦å‘**touchmove**äº‹ä»¶ï¼Œå› æ­¤éœ€è¦åœ¨**touchmove**ä¸­**æ¸…é™¤å®šæ—¶å™¨**ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ**é•¿æŒ‰**äº‹ä»¶è¿˜ä¼šè§¦å‘ç‚¹å‡»äº‹ä»¶ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®ä¸€ä¸ª**è®¡æ—¶å™¨**ï¼Œè®°å½•**touchstart**å’Œ**touchend**çš„é—´éš”æ—¶é—´ï¼Œå¦‚æœé—´éš”æ—¶é—´é•¿è¯´æ˜ç”¨æˆ·å¸Œæœ›è§¦å‘**é•¿æŒ‰**äº‹ä»¶ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥é€šè¿‡**preventDefault**å°†ç‚¹å‡»äº‹ä»¶é˜»æ­¢æ‰

  ```javascript
  // ç§»åŠ¨ç«¯é•¿æŒ‰æŒ‡ä»¤
  Vue.directive("longpress", {
      inserted: function (el) {},
      bind(el, binding) {
          let timeout = undefined;
          const INTERVAL = 200
          let start = 0;
          binding.$$startEvent = function (event) {
              //æ¨¡æ‹Ÿé•¿æŒ‰
              timeout = setTimeout(binding.value.bind(null, el, event), INTERVAL);
              start = Date.now()//è®¡æ—¶å™¨
              event.stopPropagation();
          };
          binding.$$moveEvent = function (event) {
              clearTimeout(timeout);//é¿å…å’Œæ»šåŠ¨äº‹ä»¶å†²çª
              event.stopPropagation();
          };
          binding.$$endEvent = function (event) {
              clearTimeout(timeout);//é¿å…å’Œç‚¹å‡»äº‹ä»¶å†²çª
              event.stopPropagation();
              if (Date.now() - start > INTERVAL) {//é¿å…è§¦å‘ç¥–å…ˆå…ƒç´ çš„ç‚¹å‡»äº‹ä»¶
                  event.preventDefault();
              }
          };
          el.addEventListener("touchstart", binding.$$startEvent, false);
          el.addEventListener("touchmove", binding.$$moveEvent, false);
          el.addEventListener("touchend", binding.$$endEvent, false);
      },
      unbind(el, binding) {
          el.removeEventListener("touchstart", binding.$$startEvent);
          binding.$$startEvent = null;
          el.removeEventListener("touchmove", binding.$$moveEvent);
          binding.$$moveEvent = null;
          el.removeEventListener("touchstart", binding.$$endEvent);
          binding.$$endEvent = null;
      },
      update() {}
  });
  ```




- åœ¨è·å–æ»šåŠ¨é«˜åº¦çš„æ—¶å€™ï¼Œç”¨document.documentElement.scrollTopæ— æ•ˆï¼Œå¯ä»¥é€šè¿‡document.scrollingElement.scrollTopæˆ–è€…window.scrollYè·å–
- inputè¾“å…¥æ¡†è´´åº•ï¼Œä¼šå‡ºç°è½¯é”®ç›˜è¦†ç›–inputæ¡†çš„æƒ…å†µï¼Œéœ€è¦åœ¨inputæ¡†çš„focusäº‹ä»¶ä¸­è°ƒç”¨scrollIntoView(false)æ‰èƒ½æ­£å¸¸è´´åº•
- inputè¾“å…¥æ¡†åœ¨iosä¸­è°ƒèµ·è½¯é”®ç›˜çš„æ—¶å€™é¡µé¢ä¼šè¢«ä¸Šæ¨ï¼Œä½†æ˜¯blurçš„æ—¶å€™ä¸ä¼šå›åˆ°åŸæœ¬ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦åˆ¤æ–­user-agentæ˜¯å¦iphoneï¼Œåœ¨è¾“å…¥æ¡†çš„bluräº‹ä»¶ä¸­å°†document.scrollingElement.scrollTopå‡å»å¯¹åº”çš„é«˜åº¦ï¼Œå¦åˆ™å½“ç”¨æˆ·åœ¨é¡µé¢åº•éƒ¨è°ƒèµ·è¾“å…¥æ¡†æ—¶ï¼Œè¾“å…¥æ¡†ä¼šå› ä½äºé¡µé¢çš„åŒºåŸŸè€Œå‡ºç°å¼‚å¸¸